<!DOCTYPE html>
<html>
<head>
    <title>CORS Fix Test</title>
</head>
<body>
    <h1>üîß CORS Fix Applied!</h1>
    
    <div id="test-results">
        <h2>Testing Login with Admin Credentials:</h2>
        <p><strong>Email:</strong> agrawalakshit36@gmail.com</p>
        <p><strong>Password:</strong> akshit@Mayank2003</p>
        <button onclick="testLogin()">Test Login</button>
        <div id="results"></div>
    </div>

    <script>
        async function testLogin() {
            const results = document.getElementById('results');
            results.innerHTML = '<p>‚è≥ Testing CORS fix...</p>';
            
            try {
                const response = await fetch('https://ghar-02ex.onrender.com/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        email: 'agrawalakshit36@gmail.com',
                        password: 'akshit@Mayank2003'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    results.innerHTML = `
                        <h3>‚úÖ CORS Fix Successful!</h3>
                        <p><strong>Status:</strong> ${response.status}</p>
                        <p><strong>Message:</strong> Login successful</p>
                        <p><strong>User Role:</strong> ${data.user?.role || 'Unknown'}</p>
                        <p><strong>Token:</strong> ${data.token ? 'Generated' : 'Missing'}</p>
                    `;
                } else {
                    results.innerHTML = `
                        <h3>‚ö†Ô∏è API Response (CORS Fixed, but login issue):</h3>
                        <p><strong>Status:</strong> ${response.status}</p>
                        <p><strong>Message:</strong> ${data.message}</p>
                        <p><strong>Note:</strong> No more CORS errors!</p>
                    `;
                }
            } catch (error) {
                if (error.message.includes('CORS')) {
                    results.innerHTML = `
                        <h3>‚ùå CORS Still Blocked</h3>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p>Need to restart Render deployment...</p>
                    `;
                } else {
                    results.innerHTML = `
                        <h3>‚úÖ CORS Fixed! (Other error)</h3>
                        <p><strong>Error:</strong> ${error.message}</p>
                        <p>CORS is working, this might be a different issue.</p>
                    `;
                }
            }
        }
    </script>
</body>
</html>
