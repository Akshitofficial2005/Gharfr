<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Forgot Password API</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        input, button { width: 100%; padding: 10px; margin: 10px 0; }
        .result { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background-color: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .debug { background-color: #f8f9fa; padding: 10px; margin: 10px 0; border-radius: 5px; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Debug Forgot Password API</h1>
        
        <h2>Test 1: Direct API Call</h2>
        <form id="forgotPasswordForm">
            <input type="email" id="email" placeholder="Enter email address" value="user@demo.com" required>
            <button type="submit">Test API Call</button>
        </form>
        <div id="result"></div>
        
        <h2>Test 2: API Service Import Test</h2>
        <button onclick="testAPIService()">Test API Service (like React app)</button>
        <div id="apiServiceResult"></div>
        
        <h2>Debug Information</h2>
        <div id="debugInfo" class="debug">Loading debug info...</div>
    </div>

    <script type="module">
        // Show debug information
        document.getElementById('debugInfo').innerHTML = `
            <strong>Current URL:</strong> ${window.location.href}<br>
            <strong>User Agent:</strong> ${navigator.userAgent}<br>
            <strong>Fetch Support:</strong> ${typeof fetch !== 'undefined'}<br>
            <strong>Time:</strong> ${new Date().toLocaleString()}
        `;

        // Test 1: Direct API call
        document.getElementById('forgotPasswordForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Testing...';
            
            try {
                console.log('Making API call to:', 'http://localhost:5001/api/auth/forgot-password');
                
                const response = await fetch('http://localhost:5001/api/auth/forgot-password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email })
                });
                
                console.log('Response status:', response.status);
                console.log('Response headers:', [...response.headers.entries()]);
                
                const data = await response.json();
                console.log('Response data:', data);
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <strong>✅ SUCCESS!</strong><br>
                        Message: ${data.message}<br>
                        Status: ${response.status}<br>
                        ${data.resetToken ? `<br><strong>Reset Token:</strong><br>${data.resetToken}` : ''}
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `
                        <strong>❌ API ERROR</strong><br>
                        Status: ${response.status}<br>
                        Message: ${data.message || 'Unknown error'}
                    `;
                }
            } catch (error) {
                console.error('Network error:', error);
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <strong>❌ NETWORK ERROR</strong><br>
                    Error: ${error.message}<br>
                    Type: ${error.name}<br>
                    <br><strong>This suggests:</strong><br>
                    - Backend not running on port 5001<br>
                    - CORS issues<br>
                    - Network connectivity problems
                `;
            }
        });

        // Test 2: Simulate what the React app does
        window.testAPIService = async function() {
            const resultDiv = document.getElementById('apiServiceResult');
            resultDiv.innerHTML = 'Testing API service simulation...';
            
            try {
                // Simulate the API service configuration
                const API_BASE_URL = 'http://localhost:5001/api';
                
                const response = await fetch(`${API_BASE_URL}/auth/forgot-password`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email: 'user@demo.com' })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = `
                        <strong>✅ API SERVICE TEST SUCCESS!</strong><br>
                        This means the React app should work too!<br>
                        Message: ${data.message}
                    `;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `
                        <strong>❌ API SERVICE TEST FAILED</strong><br>
                        Status: ${response.status}<br>
                        Message: ${data.message}
                    `;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = `
                    <strong>❌ API SERVICE ERROR</strong><br>
                    Error: ${error.message}<br>
                    The React app will also fail with this error.
                `;
            }
        };
    </script>
</body>
</html>
